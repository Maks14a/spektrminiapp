<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–°–ü–ï–ö–¢–†</title>

    <link rel="stylesheet" href="styles.css" />

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ */
        .dikidi-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            margin: 0;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }
        .dikidi-modal.show {
            opacity: 1;
            pointer-events: auto; /* –†–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Å–æ–±—ã—Ç–∏—è, –∫–æ–≥–¥–∞ –ø–æ–∫–∞–∑–∞–Ω */
        }

        /* —Å–∞–º ¬´–ø–æ–ø‚Äë–∞–ø¬ª: –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π iframe */
        .dikidi-iframe {
            width: 100vw;
            height: 100vh;
            max-width: 100%;
            max-height: 100%;
            border: none;
            border-radius: 0px;
            background: #fff;
            opacity: 0;
            transition: opacity 0.4s ease;
            box-sizing: border-box;
        }
        .dikidi-iframe.loaded {
            opacity: 1;
        }

        /* –∫—Ä–µ—Å—Ç–∏–∫ –∑–∞–∫—Ä—ã—Ç—å */
        .dikidi-close {
            position: absolute;
            top: 18px;
            right: 22px;
            font-size: 36px;
            color: #fff;
            cursor: pointer;
            user-select: none;
            line-height: 1;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ª–æ–∞–¥–µ—Ä–∞ */
        .dikidi-loader {
            border: 8px solid #555; /* –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–π –¥–ª—è —Ç–µ–ª–∞ –∫—Ä—É–≥–∞ */
            border-top: 8px solid rgb(240, 191, 76); /* –û—Ä–∞–Ω–∂–µ–≤—ã–π RGB: 240, 191, 76 –¥–ª—è –≤—Ä–∞—â–∞—é—â–µ–π—Å—è —á–∞—Å—Ç–∏ */
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 2s linear infinite;
            position: absolute; /* Position over the iframe area */
            z-index: 2001; /* Ensure it's above the modal background but below close button */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>

<body>
<div id="overlay-modal" class="overlay-modal" aria-hidden="true">
  <button class="overlay-close" id="overlay-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úñ</button>
  <div class="overlay-content" id="overlay-content"></div>
</div>
    <div id="intro-screen">
        <video id="intro-video" autoplay muted playsinline preload="auto">
            <source src="–ø—Ä–µ–≤—å—é.mp4" type="video/mp4" />
            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
        </video>
    </div>

    <div class="container" id="main-content">
        <img src="logo2.png" alt="–°–ü–ï–ö–¢–†" class="logo" />
        <div class="buttons">
            <button id="show-appointment-btn" class="btn btn-primary">–ó–ê–ü–ò–°–ê–¢–¨–°–Ø</button>
            <button id="show-events-btn" class="btn btn-outline">–ï–í–ï–ù–¢–´</button>
        </div>

        <img id="about-circle"    src="about.jpg"    alt="–û –Ω–∞—Å"     class="circle-img circle1" />
        <img id="teachers-circle" src="teachers.jpg" alt="–ü–µ–¥–∞–≥–æ–≥–∏"  class="circle-img circle2" />

    </div>

    <div class="container" id="appointment-screen">
        <div class="back-button" id="back-to-main-from-appointment"></div>

        <div class="appointment-layout-grid">
            <div class="image-circle"><img src="1.jpg" alt="–º–∏–∫—Ä–æ—Ñ–æ–Ω" /></div>
            <div class="image-circle"><img src="2.jpg" alt="–º–∏–∫—Ä–æ—Ñ–æ–Ω" /></div>

            <button id="dikidi-book-btn" class="btn btn-yellow grid-button">–ó–ê–ü–ò–°–ê–¢–¨–°–Ø</button>

            <div class="image-circle"><img src="3.jpg" alt="–º–∏–∫—Ä–æ—Ñ–æ–Ω" /></div>
            <div class="image-circle"><img src="4.jpg" alt="–º–∏–∫—Ä–æ—Ñ–æ–Ω" /></div>
        </div>

        <img src="logo3.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="footer-logo" />
    </div>

    <div class="container" id="events-screen">
        <div class="back-button" id="back-to-main-from-events"></div>

        <div class="events-carousel-wrapper">
            <div class="events-carousel" id="events-carousel">
                </div>
        </div>

        <div class="events-pagination" id="events-pagination"></div>
        <img src="logo3.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="footer-logo-static" />
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {

        /* ---------- DOM Element References ---------- */
        const introScreen = document.getElementById('intro-screen');
        const introVideo = document.getElementById('intro-video');
        const mainContent = document.getElementById('main-content');
        const appointmentScreen = document.getElementById('appointment-screen');
        const eventsScreen = document.getElementById('events-screen');
        const showAppointmentBtn = document.getElementById('show-appointment-btn');
        const showEventsBtn = document.getElementById('show-events-btn');
        const backToMainFromAppointmentBtn = document.getElementById('back-to-main-from-appointment');
        const backToMainFromEventsBtn = document.getElementById('back-to-main-from-events');
        const eventsCarousel = document.getElementById('events-carousel');
        const eventsPagination = document.getElementById('events-pagination');
        const allScreens = [mainContent, appointmentScreen, eventsScreen];

        let autoScrollInterval; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ID –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        let numOriginalItems = 0; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∫–∞—Ä—É—Å–µ–ª–∏

        /* =================================================================
           BUG FIX: Centralized function to handle screen transitions
           This prevents multiple screens from having the 'show' class at
           the same time, fixing the overlap issue.
           ================================================================= */
        function switchScreen(screenToShow) {
            allScreens.forEach(screen => {
                // Remove 'show' from all screens except the target one
                if (screen !== screenToShow) {
                    screen.classList.remove('show');
                }
            });
            // Add 'show' to the target screen
            screenToShow.classList.add('show');

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
            if (screenToShow === eventsScreen) {
                // –ï—Å–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —ç–∫—Ä–∞–Ω —Å–æ–±—ã—Ç–∏–π, –∑–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É
                startAutoScroll();
            } else {
                // –ï—Å–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –¥—Ä—É–≥–æ–π —ç–∫—Ä–∞–Ω, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É
                stopAutoScroll();
            }
        }

        /* ---------- Screen Transition Logic ---------- */
        introVideo.addEventListener('ended', () => {
            introScreen.classList.add('hidden');
            switchScreen(mainContent);
        });

        const playPromise = introVideo.play();
        if (playPromise !== undefined) {
            playPromise.catch(error => {
                console.error("Autoplay was blocked:", error);
                introScreen.classList.add('hidden');
                switchScreen(mainContent);
            });
        }

        // Fallback timer in case the 'ended' event doesn't fire
        setTimeout(() => {
            if (!mainContent.classList.contains('show')) {
                console.warn("Intro seems stuck, forcing main screen.");
                introScreen.classList.add('hidden');
                switchScreen(mainContent);
            }
        }, 5000); // 5 seconds

        showAppointmentBtn.onclick = () => switchScreen(appointmentScreen);

        showEventsBtn.onclick = () => {
            switchScreen(eventsScreen);
            loadEvents(); // Load events when switching to the screen
        };

        backToMainFromAppointmentBtn.onclick = () => switchScreen(mainContent);
        backToMainFromEventsBtn.onclick = () => switchScreen(mainContent);

        /* =================================================================
           PAGINATION FIX: Improved correlation between dots and slides
           ================================================================= */

        // Helper to calculate the width of a single carousel item including its gap
        function getSlideStep() {
            // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è
            if (eventsCarousel.children.length === 0) return 0;

            const firstItem = eventsCarousel.children[0];
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º clientWidth –¥–ª—è —à–∏—Ä–∏–Ω—ã —ç–ª–µ–º–µ–Ω—Ç–∞, –∏ –ø–æ–ª—É—á–∞–µ–º margin-right –∏–∑ —Å—Ç–∏–ª–µ–π
            const itemWidth = firstItem.clientWidth;
            const style = window.getComputedStyle(firstItem);
            const marginRight = parseFloat(style.marginRight);

            return itemWidth + marginRight;
        }

        function createDots() {
            eventsPagination.innerHTML = '';
            // –¢–æ—á–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            if (numOriginalItems === 0) return;

            const slideStep = getSlideStep();
            if (slideStep === 0) return;

            for (let i = 0; i < numOriginalItems; i++) {
                const dot = document.createElement('span');
                dot.className = 'pagination-dot';
                dot.addEventListener('click', () => {
                    // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
                    // –£—á–∏—Ç—ã–≤–∞–µ–º —Å–º–µ—â–µ–Ω–∏–µ –∏–∑-–∑–∞ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    eventsCarousel.scrollTo({ left: (i + numOriginalItems) * slideStep, behavior: 'smooth' });
                });
                eventsPagination.appendChild(dot);
            }
            updateDots();
        }

        function updateDots() {
            const dots = eventsPagination.querySelectorAll('.pagination-dot');
            if (eventsCarousel.children.length === 0 || numOriginalItems === 0) {
                dots.forEach(dot => dot.classList.remove('active'));
                return;
            }

            const slideStep = getSlideStep();
            if(slideStep === 0) return;

            // –°–º–µ—â–∞–µ–º scrollLeft, —á—Ç–æ–±—ã –æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª "—Ä–µ–∞–ª—å–Ω—ã–º" —ç–ª–µ–º–µ–Ω—Ç–∞–º
            const adjustedScrollLeft = eventsCarousel.scrollLeft - (numOriginalItems * slideStep);

            // –í—ã—á–∏—Å–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω–¥–µ–∫—Å, –æ–∫—Ä—É–≥–ª—è—è –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ —Ü–µ–ª–æ–≥–æ
            let activeIndex = Math.round(adjustedScrollLeft / slideStep);

            // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ activeIndex –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            if (activeIndex < 0) {
                activeIndex = (numOriginalItems + (activeIndex % numOriginalItems)) % numOriginalItems;
            } else if (activeIndex >= numOriginalItems) {
                activeIndex = activeIndex % numOriginalItems;
            }

            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === activeIndex);
            });
        }
        // –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ–±—ã—Ç–∏–π –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ—á–µ–∫ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        eventsCarousel.addEventListener('scroll', () => {
            updateDots();
            handleInfiniteScroll(); // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        }, { passive: true });


        /* ---------- Events Loading Logic ---------- */
        const API_STATIC = "https://apispectrminiapp-vozmak.amvera.io/static/";
        const API_FILES = "https://apispectrminiapp-vozmak.amvera.io/files";

        async function loadEvents() {
            try {
                const filesResponse = await fetch(API_FILES);
                if (!filesResponse.ok) throw new Error(`HTTP error! status: ${filesResponse.status}`);
                const filesData = await filesResponse.json();
                const originalMediaFiles = filesData.files.filter(filename =>
                    filename.match(/\.(jpeg|jpg|gif|png|webp|avif|mp4)$/i)
                ) || [];

                eventsCarousel.innerHTML = ''; // –û—á–∏—â–∞–µ–º –∫–∞—Ä—É—Å–µ–ª—å –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π

                if (originalMediaFiles.length > 0) {
                    numOriginalItems = originalMediaFiles.length; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤

                    // –ö–ª–æ–Ω–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
                    // –ö–ª–æ–Ω–∏—Ä—É–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –Ω–∞—á–∞–ª–∞
                    const clonedBefore = originalMediaFiles.slice(-numOriginalItems);
                    // –ö–ª–æ–Ω–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∫–æ–Ω—Ü–∞
                    const clonedAfter = originalMediaFiles.slice(0, numOriginalItems);

                    // –û–±—ä–µ–¥–∏–Ω—è–µ–º: [–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ_–ø–æ—Å–ª–µ–¥–Ω–∏–µ, –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ, –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ_–ø–µ—Ä–≤—ã–µ]
                    const combinedMedia = [...clonedBefore, ...originalMediaFiles, ...clonedAfter];

                    combinedMedia.forEach(filename => {
                        const mediaUrl = `${API_STATIC}${filename}`;
                        const fileExtension = filename.split('.').pop().toLowerCase();
                        const isVideo = fileExtension === 'mp4';

                        const eventDiv = document.createElement('div');
                        eventDiv.className = 'event-card';

                        let mediaElementHtml;
                        if (isVideo) {
                            mediaElementHtml = `<video src="${mediaUrl}" class="event-image" autoplay loop muted playsinline></video>`;
                        } else {
                            mediaElementHtml = `<img src="${mediaUrl}" alt="Event Image" class="event-image">`;
                        }

                        eventDiv.innerHTML = `${mediaElementHtml}`;
                        eventsCarousel.appendChild(eventDiv);
                    });

                    // –¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã, –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ—á–Ω—ã–π slideStep
                    const slideStep = getSlideStep();
                    if (slideStep > 0) {
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –Ω–∞ –Ω–∞—á–∞–ª–æ "—Ä–µ–∞–ª—å–Ω–æ–≥–æ" –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                        eventsCarousel.scrollLeft = numOriginalItems * slideStep;
                    }

                    createDots(); // –°–æ–∑–¥–∞–µ–º —Ç–æ—á–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –¥–ª—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤

                } else {
                    eventsCarousel.innerHTML = '<p class="no-events">–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π.</p>';
                    eventsPagination.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Ç–æ—á–∫–∏, –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π
                    numOriginalItems = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                }

            } catch (error) {
                console.error('Error loading event files:', error);
                eventsCarousel.innerHTML = '<p class="error-message">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–±—ã—Ç–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>';
                eventsPagination.innerHTML = '';
                numOriginalItems = 0;
            }
        }

        /* =================================================================
           NEW FEATURE: Automatic Carousel Scrolling and Looping
           ================================================================= */
        function startAutoScroll() {
            // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª, —á—Ç–æ–±—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ
            stopAutoScroll();

            autoScrollInterval = setInterval(() => {
                if (numOriginalItems === 0) return;
                const slideStep = getSlideStep();
                if (slideStep === 0) return;

                // –ü—Ä–æ—Å—Ç–æ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –Ω–∞ –æ–¥–∏–Ω —à–∞–≥; handleInfiniteScroll –±—É–¥–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ–º
                eventsCarousel.scrollBy({ left: slideStep, behavior: 'smooth' });
            }, 7000); // 7 —Å–µ–∫—É–Ω–¥
        }

        function stopAutoScroll() {
            if (autoScrollInterval) {
                clearInterval(autoScrollInterval);
                autoScrollInterval = null;
            }
        }

        /* =================================================================
           NEW FEATURE: Infinite Carousel Scrolling Logic
           ================================================================= */
        function handleInfiniteScroll() {
            if (numOriginalItems === 0) return;

            const slideStep = getSlideStep();
            if (slideStep === 0) return;

            const currentScrollLeft = eventsCarousel.scrollLeft;

            // –ü–æ–∑–∏—Ü–∏—è –Ω–∞—á–∞–ª–∞ "—Ä–µ–∞–ª—å–Ω–æ–≥–æ" –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–ø–æ—Å–ª–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –Ω–∞—á–∞–ª–µ)
            const startOfRealContent = numOriginalItems * slideStep;
            // –ü–æ–∑–∏—Ü–∏—è –∫–æ–Ω—Ü–∞ "—Ä–µ–∞–ª—å–Ω–æ–≥–æ" –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–∫–æ–Ω–µ—Ü –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
            const endOfRealContent = (numOriginalItems * 2) * slideStep; // (–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ_–¥–æ + –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ)

            // –ï—Å–ª–∏ –ø—Ä–æ–∫—Ä—É—Ç–∏–ª–∏ –¥–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∫–æ–Ω—Ü–µ (—Å–ø—Ä–∞–≤–∞)
            if (currentScrollLeft >= endOfRealContent) {
                eventsCarousel.style.scrollBehavior = 'auto'; // –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º –ø–ª–∞–≤–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É
                // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É "—Ä–µ–∞–ª—å–Ω–æ–≥–æ" –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                eventsCarousel.scrollLeft = startOfRealContent + (currentScrollLeft - endOfRealContent);
                // –í–∫–ª—é—á–∞–µ–º –ø–ª–∞–≤–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É –æ–±—Ä–∞—Ç–Ω–æ –ø–æ—Å–ª–µ –∫–æ—Ä–æ—Ç–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
                requestAnimationFrame(() => {
                    eventsCarousel.style.scrollBehavior = 'smooth';
                });
            }
            // –ï—Å–ª–∏ –ø—Ä–æ–∫—Ä—É—Ç–∏–ª–∏ –¥–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –Ω–∞—á–∞–ª–µ (—Å–ª–µ–≤–∞)
            else if (currentScrollLeft < startOfRealContent) {
                eventsCarousel.style.scrollBehavior = 'auto'; // –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º –ø–ª–∞–≤–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É
                // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞–µ–º –∫ –∫–æ–Ω—Ü—É "—Ä–µ–∞–ª—å–Ω–æ–≥–æ" –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                eventsCarousel.scrollLeft = endOfRealContent - (startOfRealContent - currentScrollLeft);
                // –í–∫–ª—é—á–∞–µ–º –ø–ª–∞–≤–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É –æ–±—Ä–∞—Ç–Ω–æ –ø–æ—Å–ª–µ –∫–æ—Ä–æ—Ç–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
                requestAnimationFrame(() => {
                    eventsCarousel.style.scrollBehavior = 'smooth';
                });
            }
        }


        /* ---------- DIKIDI Widget Logic ---------- */
        const WIDGET_URL = 'https://dikidi.ru/#widget=190962';
        const btnBook = document.getElementById('dikidi-book-btn');
        btnBook.addEventListener('click', openDikidiModal);

        function openDikidiModal() {
            if (document.querySelector('.dikidi-modal')) return;

            const modal = document.createElement('div');
            modal.className = 'dikidi-modal';

            const close = document.createElement('span');
            close.className = 'dikidi-close';
            close.textContent = '√ó';
            close.onclick = () => {
                modal.classList.remove('show');
                setTimeout(() => modal.remove(), 250);
            };

            const loader = document.createElement('div');
            loader.className = 'dikidi-loader';

            const frame = document.createElement('iframe');
            frame.src = WIDGET_URL;
            frame.className = 'dikidi-iframe';
            frame.allow = 'payment *; fullscreen';

            frame.style.width = `${window.innerWidth}px`;
            frame.style.height = `${window.innerHeight}px`;

            frame.onload = () => {
                loader.remove();
                frame.classList.add('loaded');
            };

            modal.appendChild(loader);
            modal.appendChild(frame);
            modal.appendChild(close);
            document.body.appendChild(modal);
            requestAnimationFrame(() => modal.classList.add('show'));
        }

        /* ---------- Carousel Dragging Logic ---------- */
        let isDown = false;
        let startX;
        let scrollLeft;
        let wheelTimeout; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ç–∞–π–º–∞—É—Ç–∞ –∫–æ–ª–µ—Å–∞ –º—ã—à–∏

        function startDragging(e) {
            isDown = true;
            eventsCarousel.classList.add('dragging');
            startX = (e.pageX || e.touches[0].pageX) - eventsCarousel.offsetLeft;
            scrollLeft = eventsCarousel.scrollLeft;
            stopAutoScroll(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø—Ä–∏ —Ä—É—á–Ω–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
        }

        function stopDragging() {
            isDown = false;
            eventsCarousel.classList.remove('dragging');
            // –ü—Ä–∏ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–∏ –º—ã—à–∏/–ø–∞–ª—å—Ü–∞, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫—É, –µ—Å–ª–∏ –º—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Å–æ–±—ã—Ç–∏–π
            if (eventsScreen.classList.contains('show')) {
                startAutoScroll();
            }
        }

        function drag(e) {
            if (!isDown) return;
            e.preventDefault();
            const x = (e.pageX || e.touches[0].pageX) - eventsCarousel.offsetLeft;
            const walk = (x - startX) * 2;
            eventsCarousel.scrollLeft = scrollLeft - walk;
        }

        // Mouse events
        eventsCarousel.addEventListener('mousedown', startDragging);
        eventsCarousel.addEventListener('mouseleave', stopDragging);
        eventsCarousel.addEventListener('mouseup', stopDragging);
        eventsCarousel.addEventListener('mousemove', drag);

        // Touch events
        eventsCarousel.addEventListener('touchstart', startDragging);
        eventsCarousel.addEventListener('touchend', stopDragging);
        eventsCarousel.addEventListener('touchcancel', stopDragging);
        eventsCarousel.addEventListener('touchmove', drag);

        // --- Mouse Wheel Scrolling ---
        eventsCarousel.addEventListener('wheel', (e) => {
            if (e.deltaY !== 0) { // Prevent page scroll only for vertical wheel
                e.preventDefault();
                eventsCarousel.scrollLeft += e.deltaY;
                stopAutoScroll(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø—Ä–∏ —Ä—É—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –ø–æ—Å–ª–µ –∫–æ—Ä–æ—Ç–∫–æ–π –ø–∞—É–∑—ã
                clearTimeout(wheelTimeout); // –ò—Å–ø–æ–ª—å–∑—É–µ–º wheelTimeout
                wheelTimeout = setTimeout(() => {
                    if (eventsScreen.classList.contains('show')) {
                        startAutoScroll();
                    }
                }, 1000); // –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–ª–µ—Å–∞
            }
        });

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º scroll-behavior: smooth –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        eventsCarousel.style.scrollBehavior = 'smooth';

        // === –ú–æ–¥–∞–ª–∫–∞ ¬´–û –Ω–∞—Å¬ª –∏ ¬´–ü–µ–¥–∞–≥–æ–≥–∏¬ª ===
        const aboutCircle    = document.getElementById('about-circle');
        const teachersCircle = document.getElementById('teachers-circle');
        const overlayModal   = document.getElementById('overlay-modal');
        const overlayContent = document.getElementById('overlay-content');
        const overlayClose   = document.getElementById('overlay-close');

        function openOverlay(innerHTML){
        overlayContent.innerHTML = innerHTML;
        overlayModal.classList.add('show');
        document.body.style.overflow = 'hidden';
        }
        function closeOverlay(){
        overlayModal.classList.remove('show');
        overlayContent.classList.remove('gallery-open'); // <= —Å–±—Ä–æ—Å —Ä–µ–∂–∏–º–∞ –≥–∞–ª–µ—Ä–µ–∏
        overlayContent.innerHTML = '';
        document.body.style.overflow = '';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ
        overlayClose.addEventListener('click', closeOverlay);
        overlayModal.addEventListener('click', (e) => {
        if (e.target === overlayModal) closeOverlay();
        });

        // ¬´–û –Ω–∞—Å¬ª ‚Üí —Ç–µ–∫—Å—Ç
        if (aboutCircle) {
        aboutCircle.addEventListener('click', () => {
            overlayContent.classList.remove('gallery-open'); // <= –≤–∞–∂–Ω–æ
            openOverlay(`
            <div class="about-content">
                <h2 style="margin:0 0 10px 0;">–û –Ω–∞—Å</h2>
                <p><strong>–í–æ–∫–∞–ª—å–Ω–∞—è —Å—Ç—É–¥–∏—è ¬´–°–ø–µ–∫—Ç—Ä¬ª</strong> ‚Äì —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —à–∫–æ–ª–∞, —ç—Ç–æ –≤—Ç–æ—Ä–æ–π –¥–æ–º.</p>
                <p><strong>–ó–¥–µ—Å—å –≤—ã —Å–º–æ–∂–µ—Ç–µ:</strong></p>
                <p>üíõ –†–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ –≤–æ–∫–∞–ª—å–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–æ–π –∏ –ø—Ä–µ–æ–¥–æ–ª–µ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ö–∏.</p>
                <p>üíõ –£–∑–Ω–∞–≤–∞—Ç—å —Å–µ–±—è, —Ä–∞–∑–≤–∏–≤–∞—Ç—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏ —Ç–≤–æ—Ä—á–µ—Å–∫—É—é –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ—Å—Ç—å.</p>
                <p>üíõ –£—á–∏—Ç—å—Å—è —Ç–æ–º—É, –∫–∞–∫ –≥–æ–ª–æ—Å –ø–µ—Ä–µ–¥–∞—ë—Ç –Ω–∞—Å—Ç–æ—è—â–∏–µ —ç–º–æ—Ü–∏–∏.</p>
                </ul>
                <p>–ú—ã —Å–æ–±–ª—é–¥–∞–µ–º –±–∞–ª–∞–Ω—Å —Å—Ç—Ä–æ–≥–æ—Å—Ç–∏ –∏ —É—é—Ç–∞: –≤—ã –ø–æ—á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è –∫–∞–∫ –¥–æ–º–∞, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –±—É–¥–µ—Ç–µ —Ä–∞—Å—Ç–∏, —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å—Å—è –∏ –ø—Ä–µ–æ–¥–æ–ª–µ–≤–∞—Ç—å —Å–≤–æ–∏ –≥—Ä–∞–Ω–∏—Ü—ã.</p>
                <p><strong>üíõ –í–∞—à —É—Å–ø–µ—Ö ‚Äî –Ω–∞—à–∞ —Ü–µ–ª—å, –∏ –º—ã –±—É–¥–µ–º —Ä—è–¥–æ–º —Å –≤–∞–º–∏, —Ä—É–∫–∞ –æ–± —Ä—É–∫—É.</strong></p>
            </div>
            `);
        });
        }

        // ¬´–ü–µ–¥–∞–≥–æ–≥–∏¬ª ‚Üí –∫–∞—Ä—É—Å–µ–ª—å –∏–∑ 2 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        if (teachersCircle) {
        teachersCircle.addEventListener('click', () => {
        overlayContent.classList.add('gallery-open'); // <= –≤–∫–ª—é—á–∏–ª–∏ —Ä–µ–∂–∏–º
        openOverlay(`
            <div class="gallery">
                <div class="gallery-track" id="gallery-track">
                <img src="pavel.jpg" class="gallery-item" alt="–ü–∞–≤–µ–ª –ë–µ—Ä–Ω–∞—Ü–∫–∏–π">
                <img src="arseniy.jpg" class="gallery-item" alt="–ê—Ä—Å–µ–Ω–∏–π –ë—Ä–æ–Ω—Å–∫–∏–π">
                </div>
                <div class="gallery-dots" id="gallery-dots">
                <span class="gallery-dot active"></span>
                <span class="gallery-dot"></span>
                </div>
            </div>
            `);

        const track = document.getElementById('gallery-track');
        const dots  = document.querySelectorAll('#gallery-dots .gallery-dot');

        function stepWidth(){            // —Ä–æ–≤–Ω–æ —à–∏—Ä–∏–Ω–∞ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏
            return track.clientWidth;
        }
        function updateDots(){
        const idx = Math.round(track.scrollLeft / stepWidth());
        dots.forEach((d,i)=>d.classList.toggle('active', i === idx));
        }

        requestAnimationFrame(updateDots);
        window.addEventListener('resize', updateDots);
        track.addEventListener('scroll', updateDots, { passive:true });

        dots.forEach((dot, i) => {
            dot.addEventListener('click', () => {
                track.scrollTo({ left: i * stepWidth(), behavior: 'smooth' });
            });
        });
        });
        }
    });
</script>



    <script src="https://dikidi.ru/assets/js/widget_record/widget2.min.js?v=1735141723"></script>
</body>
</html>
